{%- comment -%}
  TO-DO: Whitespace cleanup
{%- endcomment -%}

{%- liquid
  assign current_variant = product.selected_or_first_available_variant

  if section.settings.show_featured_media_first and product.selected_variant == blank
    assign featured_media = product.featured_media
  else
    assign featured_media = current_variant.featured_media | default: product.featured_media
  endif

  assign product_link = product.url | within: collection

  assign price_content_type = 'price'

  if current_variant.available
    if current_variant.price == 0 and current_variant.compare_at_price == null
      if settings.zero_dollar_product_price_display == 'hide'
        assign price_content_type = 'hide'
        assign custom_price_content = blank
      elsif settings.zero_dollar_product_price_display == 'replace'
        assign price_content_type = 'custom'
        assign custom_price_content = 'products.inventory.zero_price_custom_label' | t
      endif
    endif
  else
    if settings.sold_out_product_price_display == 'hide'
      assign price_content_type = 'hide'
      assign custom_price_content = blank
    elsif settings.sold_out_product_price_display == 'replace'
      assign price_content_type = 'custom'
      assign custom_price_content = 'products.inventory.sold_out_price_custom_label' | t
    endif
  endif

  capture custom_swatch_color_maps
    render 'get-custom-swatch-color-maps'
  endcapture

  assign custom_color_key_map = custom_swatch_color_maps | split: ' | ' | first | split: ','
  assign custom_color_value_map = custom_swatch_color_maps | split: ' | ' | last | split: ','
-%}

<div class="quick-product--background-spacer"></div>

{%- capture rendered_content -%}
  <div
    class="quick-product"
    data-section-type="product"
    data-section-id="{{ section.id }}"
    data-is-quick-view="true"
    data-zero-price-display="{{ settings.zero_dollar_product_price_display }}"
    data-zero-price-custom-content="{{ 'products.inventory.zero_price_custom_label' | t }}"
    data-sold-out-price-display="{{ settings.sold_out_product_price_display }}"
    data-sold-out-price-custom-content="{{ 'products.inventory.sold_out_price_custom_label' | t }}"
    data-price-display-type="{{ price_content_type }}"
  >
    <div class="quick-product--left">
      <div class="product__media-container">
        <div class="product__media">
          {%- for media in product.media -%}
            <div
              class="product__media-item {% unless media.id == featured_media.id %} hidden{% endunless %}"
              data-media-item-id="{{ media.id }}"
              data-media-type="{{ media.media_type }}"
              data-product-media-wrapper
            >
              {%
                render 'media',
                media: media,
                fallback_alt: product.title,
                featured_media: featured_media,
                link: product_link,
                enable_product_lightbox: section.settings.enable_product_lightbox,
                loop_video: section.settings.enable_video_looping,
                aspect_ratio: section.settings.image_aspect_ratio,
                sizes: "300px",
                within_carousel: false
              %}
            </div>
          {%- else -%}
            <div class="product__media-item placeholder-image">
              {{ 'image' | placeholder_svg_tag: 'placeholder-svg' }}
            </div>
          {%- endfor -%}
        </div>
      </div>
    </div>
    <div class="quick-product--right">
      <div class="quick-product--right-viewport" data-scroll-lock-ignore>
        <div class="quick-product--right-inner animation animation--quick-view-items">
          <div class="quick-product--header-block-wrap">
            {%-
              render 'product-block-header',
              product: product,
              block_settings: section.settings,
              current_variant: current_variant,
              is_quick: true,
              featured_media: featured_media,
              price_content_type: price_content_type,
              custom_price_content: custom_price_content
            -%}
          </div>
          {%-
            render 'product-blocks',
            prod: product,
            blocks: section.blocks,
            is_quick: true,
            is_featured: false,
            current_variant: current_variant,
            featured_media: featured_media,
            price_content_type: price_content_type,
            custom_price_content: custom_price_content,
            custom_color_key_map: custom_color_key_map,
            custom_color_value_map: custom_color_value_map
          -%}

          {% if section.settings.enable_gift_card_recipient and product.gift_card? -%}
            {% render 'gift-card-recipient-form', source: 'product-display', product: product %}
          {%- endif %}
        </div>
      </div>
      <div class="quick-product--right-viewport-fade--wrap">
        <div class="quick-product--right-viewport-fade"></div>
      </div>
      <div class="quick-product--right-viewport--footer">
        {%-
          render 'product-block-buy-buttons',
          prod: product,
          block: block,
          blocks: section.blocks,
          current_variant: current_variant,
          is_quick: true,
          price_content_type: price_content_type,
          custom_price_content: custom_price_content
        -%}
      </div>
    </div>
  </div>
{%- endcapture -%}

{% render 'quick-view-modal-base', content: rendered_content, open: true %}

{% schema %}
{
  "name": "t:sections.main_product_quick.name",
  "tag": "section",
  "class": "quick-view-product",
  "settings": [
    {
      "type": "header",
      "content": "t:sections.main_product_quick.settings.product_quick_view.header.content"
    },
    {
      "type": "paragraph",
      "content": "t:sections.main_product_quick.settings.product_quick_view.paragraph.content"
    },
    {
      "type": "checkbox",
      "id": "show_featured_media_first",
      "label": "t:sections.shared.product.settings.media.show_featured_media_first.label",
      "info": "t:sections.shared.product.settings.media.show_featured_media_first.info"
    },
    {
      "type": "select",
      "id": "image_aspect_ratio",
      "label": "t:shared.settings.aspect_ratio.label",
      "options": [
        {
          "value": "natural",
          "label": "t:shared.options.aspect_ratio.natural"
        },
        {
          "value": "square",
          "label": "t:shared.options.aspect_ratio.square"
        },
        {
          "value": "portrait",
          "label": "t:shared.options.aspect_ratio.portrait"
        },
        {
          "value": "landscape",
          "label": "t:shared.options.aspect_ratio.landscape"
        }
      ],
      "default": "natural"
    },
    {
      "type": "header",
      "content": "t:sections.shared.product.settings.product_header.header.content"
    },
    {
      "type": "checkbox",
      "id": "show_divider",
      "label": "t:sections.shared.product.settings.product_header.show_divider.label",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "label": "t:sections.shared.product.settings.product_header.show_vendor.label",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_sku",
      "label": "t:sections.shared.product.settings.product_header.show_sku.label",
      "default": true
    },
    {
      "type": "header",
      "content": "t:sections.shared.product.settings.price.header.content"
    },
    {
      "type": "checkbox",
      "id": "show_discount",
      "label": "t:sections.shared.product.settings.price.show_discount.label",
      "default": true
    },
    {
      "type": "select",
      "id": "discount_format",
      "label": "t:sections.shared.product.settings.price.discount_format.label",
      "options": [
        {
          "value": "sale_text",
          "label": "t:shared.settings.discount_format.option_sale_text"
        },
        {
          "value": "percent_off",
          "label": "t:shared.settings.discount_format.option_percent_off"
        },
        {
          "value": "minus_percent",
          "label": "t:shared.settings.discount_format.option_minus_percent"
        },
        {
          "value": "save_percent",
          "label": "t:shared.settings.discount_format.option_save_percent"
        },
        {
          "value": "amount_off",
          "label": "t:shared.settings.discount_format.option_amount_off"
        },
        {
          "value": "minus_amount",
          "label": "t:shared.settings.discount_format.option_minus_amount"
        },
        {
          "value": "save_amount",
          "label": "t:shared.settings.discount_format.option_save_amount"
        }
      ],
      "default": "percent_off"
    },
    {
      "type": "header",
      "content": "t:sections.shared.product.settings.product_rating.header.content"
    },
    {
      "type": "paragraph",
      "content": "t:sections.shared.product.settings.product_rating.paragraph.content"
    },
    {
      "type": "checkbox",
      "id": "show_product_rating",
      "label": "t:sections.shared.product.settings.product_rating.show_product_rating.label"
    },
    {
      "type": "header",
      "content": "t:sections.shared.product.settings.product_badges.header.content"
    },
    {
      "type": "paragraph",
      "content": "t:sections.shared.product.settings.product_badges.paragraph.content"
    },
    {
      "type": "checkbox",
      "id": "show_sale_badge",
      "label": "t:shared.settings.badges.show_sale_badge.label",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_custom_badges",
      "label": "t:shared.settings.badges.show_custom_badges.label",
      "default": true
    },
    {
      "type": "header",
      "content": "t:sections.shared.product.settings.gift_card.header.content"
    },
    {
      "type": "checkbox",
      "id": "enable_gift_card_recipient",
      "label": "t:sections.shared.product.settings.gift_card.enable_gift_card_recipient.label",
      "default": true,
      "info": "t:sections.shared.product.settings.gift_card.enable_gift_card_recipient.info"
    }
  ],
  "blocks": [
    {
      "type": "description",
      "name": "t:sections.shared.product.blocks.description.name",
      "limit": 1,
      "settings": [
        {
          "type": "select",
          "id": "text_font_class",
          "label": "t:shared.settings.text_font_class.label",
          "options": [
            {
              "value": "fs-body-75",
              "label": "t:shared.settings.text_font_class.options.small"
            },
            {
              "value": "fs-body-100",
              "label": "t:shared.settings.text_font_class.options.regular"
            },
            {
              "value": "fs-body-200",
              "label": "t:shared.settings.text_font_class.options.large"
            }
          ],
          "default": "fs-body-100"
        }
      ]
    },
    {
      "type": "quantity_selector",
      "name": "t:sections.shared.product.blocks.quantity_selector.name",
      "limit": 1,
      "settings": [
        {
          "type": "checkbox",
          "id": "show_labels",
          "label": "t:sections.shared.product.blocks.quantity_selector.settings.show_labels.label",
          "default": true
        }
      ]
    },
    {
      "type": "share",
      "name": "t:sections.shared.product.blocks.share.name",
      "limit": 1,
      "settings": [
        {
          "type": "paragraph",
          "content": "t:sections.shared.product.blocks.share.settings.paragraph_1.content"
        },
        {
          "type": "paragraph",
          "content": "t:sections.shared.product.blocks.share.settings.paragraph_2.content"
        }
      ]
    },
    {
      "type": "inventory-counter",
      "name": "t:sections.shared.product.blocks.inventory_counter.name",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "label",
          "label": "t:sections.shared.product.blocks.inventory_counter.settings.label.label",
          "default": "t:sections.shared.product.blocks.inventory_counter.settings.label.default"
        },
        {
          "type": "text",
          "id": "inventory_max",
          "label": "t:sections.shared.product.blocks.inventory_counter.settings.inventory_max.label",
          "info": "t:sections.shared.product.blocks.inventory_counter.settings.inventory_max.info",
          "default": "t:sections.shared.product.blocks.inventory_counter.settings.inventory_max.default"
        },
        {
          "type": "text",
          "id": "low_inventory_threshold",
          "label": "t:sections.shared.product.blocks.inventory_counter.settings.low_inventory_threshold.label",
          "info": "t:sections.shared.product.blocks.inventory_counter.settings.low_inventory_threshold.info",
          "default": "t:sections.shared.product.blocks.inventory_counter.settings.low_inventory_threshold.default"
        },
        {
          "type": "checkbox",
          "id": "show_status_bar",
          "label": "t:sections.shared.product.blocks.inventory_counter.settings.show_status_bar.label",
          "default": true
        },
        {
          "type": "checkbox",
          "id": "show_untracked_quantity",
          "label": "t:sections.shared.product.blocks.inventory_counter.settings.show_untracked_quantity.label"
        }
      ]
    },
    {
      "type": "text",
      "name": "t:sections.shared.product.blocks.text.name",
      "settings": [
        {
          "type": "select",
          "id": "text_font_class",
          "label": "t:shared.settings.text_font_class.label",
          "options": [
            {
              "value": "fs-body-75",
              "label": "t:shared.settings.text_font_class.options.small"
            },
            {
              "value": "fs-body-100",
              "label": "t:shared.settings.text_font_class.options.regular"
            },
            {
              "value": "fs-body-200",
              "label": "t:shared.settings.text_font_class.options.large"
            }
          ],
          "default": "fs-body-100"
        },
        {
          "type": "richtext",
          "id": "text",
          "label": "t:sections.shared.product.blocks.text.settings.text.label",
          "default": "t:sections.shared.product.blocks.text.settings.text.default"
        }
      ]
    },
    {
      "type": "variant_picker",
      "name": "t:sections.shared.product.blocks.variant_picker.name",
      "limit": 1,
      "settings": [
        {
          "type": "header",
          "content": "t:sections.shared.product.blocks.variant_picker.settings.popup.header.content"
        },
        {
          "type": "paragraph",
          "content": "t:sections.shared.product.blocks.variant_picker.settings.popup.paragraph.content"
        },
        {
          "type": "text",
          "id": "variant_popup_option",
          "label": "t:sections.shared.product.blocks.variant_picker.settings.popup.variant_popup_option.label",
          "info": "t:sections.shared.product.blocks.variant_picker.settings.popup.variant_popup_option.info",
          "default": "t:sections.shared.product.blocks.variant_picker.settings.popup.variant_popup_option.default"
        },
        {
          "type": "select",
          "id": "variant_popup_icon",
          "label": "t:sections.shared.product.blocks.variant_picker.settings.popup.variant_popup_icon.label",
          "options": [
            {
              "value": "none",
              "label": "t:shared.options.icon.none"
            },
            {
              "value": "bank",
              "label": "t:shared.options.icon.bank"
            },
            {
              "value": "bill",
              "label": "t:shared.options.icon.bill"
            },
            {
              "value": "bottle",
              "label": "t:shared.options.icon.bottle"
            },
            {
              "value": "chat",
              "label": "t:shared.options.icon.chat"
            },
            {
              "value": "chat-empty",
              "label": "t:shared.options.icon.chat_empty"
            },
            {
              "value": "checked-box",
              "label": "t:shared.options.icon.checked_box"
            },
            {
              "value": "clothes-button",
              "label": "t:shared.options.icon.clothes_button"
            },
            {
              "value": "clothes-hanger",
              "label": "t:shared.options.icon.clothes_hanger"
            },
            {
              "value": "cotton",
              "label": "t:shared.options.icon.cotton"
            },
            {
              "value": "envelope",
              "label": "t:shared.options.icon.envelope"
            },
            {
              "value": "globe",
              "label": "t:shared.options.icon.globe"
            },
            {
              "value": "hand-washing",
              "label": "t:shared.options.icon.hand_washing"
            },
            {
              "value": "heart",
              "label": "t:shared.options.icon.heart"
            },
            {
              "value": "laundry-dryer",
              "label": "t:shared.options.icon.laundry_dryer"
            },
            {
              "value": "laundry-washer",
              "label": "t:shared.options.icon.laundry_washer"
            },
            {
              "value": "leaf",
              "label": "t:shared.options.icon.leaf"
            },
            {
              "value": "lipstick",
              "label": "t:shared.options.icon.lipstick"
            },
            {
              "value": "measuring-tape",
              "label": "t:shared.options.icon.measuring_tape"
            },
            {
              "value": "money-bills",
              "label": "t:shared.options.icon.money_bills"
            },
            {
              "value": "moving-truck",
              "label": "t:shared.options.icon.moving_truck"
            },
            {
              "value": "package-closed",
              "label": "t:shared.options.icon.package_closed"
            },
            {
              "value": "package-open",
              "label": "t:shared.options.icon.package_open"
            },
            {
              "value": "padlock",
              "label": "t:shared.options.icon.padlock"
            },
            {
              "value": "paper-airplane",
              "label": "t:shared.options.icon.paper_airplane"
            },
            {
              "value": "paw-print",
              "label": "t:shared.options.icon.paw_print"
            },
            {
              "value": "plant",
              "label": "t:shared.options.icon.plant"
            },
            {
              "value": "price-tag",
              "label": "t:shared.options.icon.price_tag"
            },
            {
              "value": "question-mark",
              "label": "t:shared.options.icon.question_mark"
            },
            {
              "value": "recycle-symbol",
              "label": "t:shared.options.icon.recycle_symbol"
            },
            {
              "value": "ruler",
              "label": "t:shared.options.icon.ruler"
            },
            {
              "value": "scissors",
              "label": "t:shared.options.icon.scissors"
            },
            {
              "value": "security-badge",
              "label": "t:shared.options.icon.security_badge"
            },
            {
              "value": "silhouette",
              "label": "t:shared.options.icon.silhouette"
            },
            {
              "value": "stiletto",
              "label": "t:shared.options.icon.stiletto"
            },
            {
              "value": "stopwatch",
              "label": "t:shared.options.icon.stopwatch"
            },
            {
              "value": "sunflower",
              "label": "t:shared.options.icon.sunflower"
            },
            {
              "value": "tshirt",
              "label": "t:shared.options.icon.tshirt"
            },
            {
              "value": "washing-symbol",
              "label": "t:shared.options.icon.washing_symbol"
            },
            {
              "value": "water-bottle",
              "label": "t:shared.options.icon.water_bottle"
            }
          ],
          "default": "none"
        },
        {
          "type": "image_picker",
          "id": "custom_icon_image",
          "label": "t:sections.shared.product.blocks.variant_picker.settings.popup.custom_icon_image.label"
        },
        {
          "type": "text",
          "id": "variant_popup_text",
          "label": "t:sections.shared.product.blocks.variant_picker.settings.popup.variant_popup_text.label",
          "default": "t:sections.shared.product.blocks.variant_picker.settings.popup.variant_popup_text.default"
        },
        {
          "type": "page",
          "id": "variant_popup_page",
          "label": "t:sections.shared.product.blocks.variant_picker.settings.popup.variant_popup_page.label",
          "info": "t:sections.shared.product.blocks.variant_picker.settings.popup.variant_popup_page.info"
        },
        {
          "type": "header",
          "content": "t:sections.shared.product.blocks.variant_picker.settings.swatches.header.content"
        },
        {
          "type": "paragraph",
          "content": "t:sections.shared.product.blocks.variant_picker.settings.swatches.paragraph.content"
        },
        {
          "type": "select",
          "id": "swatch_size",
          "label": "t:shared.settings.swatch_size.label",
          "options": [
            {
              "value": "small",
              "label": "t:shared.settings.swatch_size.options.small"
            },
            {
              "value": "medium",
              "label": "t:shared.settings.swatch_size.options.medium"
            },
            {
              "value": "large",
              "label": "t:shared.settings.swatch_size.options.large"
            }
          ],
          "default": "medium"
        },
        {
          "type": "header",
          "content": "t:sections.shared.product.blocks.variant_picker.settings.chips.header.content"
        },
        {
          "type": "select",
          "id": "chip_layout",
          "label": "t:shared.settings.chip_layout.label",
          "options": [
            {
              "value": "3col",
              "label": "t:shared.settings.chip_layout.options.3col"
            },
            {
              "value": "2col",
              "label": "t:shared.settings.chip_layout.options.2col"
            },
            {
              "value": "natural",
              "label": "t:shared.settings.chip_layout.options.natural"
            }
          ]
        }
      ]
    }
  ]
}
{% endschema %}

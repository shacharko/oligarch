{% liquid
  # 1. הסרת כל הלוגיקה הישנה המבוססת על וריאציות של מוצר יחיד.
  
  # 2. משיכת הקולקציה מהגדרות הסקשן
  assign source_collection = section.settings.source_collection
  assign sample_products = source_collection.products
  
  # הגדרת מפתח שדה המטא הבוליאני החדש
  assign is_sample_set_key = 'metafields.custom.is_sample_set'

  # 3. סינון המוצרים: בחר רק את אלה שבהם is_sample_set הוא TRUE
  # הערה: השתמשנו ב-'true' כ-string, כפי ששופיפיי דורשת בסינון Liquid
  assign filtered_products = sample_products | where: is_sample_set_key, 'true'
%}


<section id="main-brand-sample-set-{{ section.id }}" class="main-brand-sample-set">
{% if section.settings.show_header %}
<div class="collection-list-slider__meta carousel__navigation-wrapper">
<div class="section-introduction animation--section-introduction">
<h2 class="collection-list-slider__heading ff-heading fs-heading-3-base section-introduction__heading">
{{ section.settings.heading | default: 'מותגי Sample Set' }}
</h2>
{% if section.settings.cta_url != blank and section.settings.cta_label != blank %}
<div class="button-block__button button-block__button--justify- button-block__button--justify-mobile- collection-list-slider__button section-introduction__button">
<a href="{{ section.settings.cta_url }}" class="btn btn--callout"><span>{{ section.settings.cta_label }}</span></a>
</div>
{% endif %}
</div>
</div>
{% endif %}

{% if filtered_products == nil or filtered_products.size == 0 %}
<div class="container">
<p style="margin:1rem 0;">
  לא נמצאו מוצרי קיט להצגה. ודאו שהקולקציה נבחרה ושהמוצרים סומנו ב-Metafield: **`is_sample_set`** כ-**`True`**.
</p>
</div>
{% else %}

<div class="collection-list-grid" role="list">
{% for product_item in filtered_products %}
{% liquid
  #  (product_item)
  assign brand = product_item.title 
  assign target_url = product_item.url 
  assign card_image = product_item.featured_image
  
  # Brand Info 
  assign brand_handle = brand | handleize
  assign entry = shop.metaobjects.brand_info[brand_handle]

  # לוגיקה לבחירת תמונה (הקוד הישן מותאם עכשיו ל-product_item)
  if entry != blank and entry.brand_image_card != blank
    assign card_image = entry.brand_image_card
  elsif entry != blank and entry.brand_logo != blank
    assign card_image = entry.brand_logo
  endif
  if card_image == nil
    assign card_image = product_item.featured_image
  endif
  
%}

<div class="collection-list-grid__item" role="listitem">


<div class="
collection-item
collection-item--label-overlay
collection-item--label-background-gradient
animation--item
"
style="
--overlay-text-color:#ffffff;
--label-background:#000000;
--label-gradient-start:rgba(0,0,0,0.4);
--label-gradient-mid:rgba(0,0,0,0.2);
--label-gradient-end:rgba(0,0,0,0);
"
>
<a href="{{ target_url }}" aria-label="{{ brand | escape }}" class="collection-item__image-wrapper hover">
<div class="image collection-item__image aspect-ratio--portrait animation--lazy-load">
{% assign widths = "150,200,240,280,300,360,400,450,500,550,600,650,700,750,800,850,900,950,1000" | split: "," %}
<img
alt="{{ brand | escape }}"
class="image__img"
loading="lazy"
width="1200"
height="1593"
src="{{ card_image | image_url: width: 320 }}"
srcset="{% for w in widths %}{{ card_image | image_url: width: w }} {{ w }}w{% unless forloop.last %}, {% endunless %}{% endfor %}"
sizes="(min-width: 720px) calc(calc(100vw - calc(2 * clamp(18px, 3.3vw, 3.3vw))) / 4),
calc(calc(100vw - calc(2 * clamp(18px, 3.3vw, 3.3vw))) / 2)"
onload="this.closest('.image')?.classList.add('loaded')"
>
</div>

<div class="collection-item__label">
<h4 class="collection-item__title fs-body-100 ff-heading">
<span>{{ brand }}</span>
<span class="collection-item__icon">
<svg viewBox="0 0 24 24" aria-hidden="true" focusable="false" xmlns="http://www.w3.org/2000/svg"><path d="M0 12.5h23m-9.2 9.4 9.2-9.4-9.2-9.4" stroke="currentColor" stroke-width="1.75"/></svg>
</span>
</h4>
</div>
</a>
</div>
</div>
{% endfor %}
</div>
{% endif %}
</section>

<style>
/* ==== פריסת הגריד: 2 במובייל / 4 בדסקטופ ==== */
#main-brand-sample-set-{{ section.id }} .collection-list-grid{
display:grid;
grid-template-columns: repeat(2, minmax(0,1fr));
gap: 24px;
}
@media(min-width: 900px){
#main-brand-sample-set-{{ section.id }} .collection-list-grid{
grid-template-columns: repeat(4, minmax(0,1fr));
}
}

/* התאמה מינורית – שמירה על התנהגות של הכרטיסים כמו בתבנית */
#main-brand-sample-set-{{ section.id }} .collection-item__image.aspect-ratio--portrait{
position:relative;
width:100%;
overflow:hidden;
}
#main-brand-sample-set-{{ section.id }} .collection-item__image .image__img{
width:100%;
height:auto;
display:block;
object-fit: cover;
}
#main-brand-sample-set-{{ section.id }} .collection-list-grid__item {
  border: 1px solidrgb(147, 145, 145); /* מסגרת דקה ועדינה בצבע אפור בהיר */
  border-radius: 8px; /* עיגול פינות */
  overflow: hidden; /* לוודא שכל התוכן מעוגל */
  padding: 0; /* בדרך כלל אין צורך אבל מוודא שאין ריפוד פנימי */
}
</style>

{% schema %}
{
"name": "Main Brand Sample Set",
"tag": "section",
"class": "section section--main-brand-sample-set",
"settings": [
{
"type": "checkbox",
"id": "show_header",
"label": "להציג כותרת ו־CTA",
"default": false
},
{
"type": "text",
"id": "heading",
"label": "כותרת",
"default": "מותגי Sample Set"
},
{
"type": "url",
"id": "cta_url",
"label": "קישור כפתור (אופציונלי)"
},
{
"type": "text",
"id": "cta_label",
"label": "טקסט כפתור (אופציונלי)",
"default": "כל הקולקציות"
},
{
"type": "collection",
"id": "source_collection",
"label": "קולקציה ראשית לסינון מוצרי קיט"
}
],
"presets": [
{
"name": "Main Brand Sample Set",
"category": "Custom"
}
]
}
{% endschema %}
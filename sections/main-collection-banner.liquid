{%- liquid
  assign show_collection_image = section.settings.show_collection_image
  assign collection_image = blank

  if show_collection_image and collection.handle != 'vendors' and collection.handle != 'all'
    if collection.image != blank
      assign collection_image = collection.image
    endif
    if section.settings.image != blank
      assign collection_image = section.settings.image
    endif
  endif

  if section.settings.show_collection_description
    assign collection_description = collection.description
  endif

  assign overlay_opacity = section.settings.overlay_opacity | divided_by: 100.0
  assign text_position = section.settings.text_position | split: '_'
  assign horizontal_position = text_position | first
  assign vertical_position = text_position | last

  assign text_position_modifier = 'center'

  if horizontal_position == 'flex-start'
    assign text_position_modifier = 'left'
  elsif horizontal_position == 'flex-end'
    assign text_position_modifier = 'right'
  endif

  assign text_position_mobile = section.settings.text_position_mobile | split: '_'
  assign horizontal_position_mobile = text_position_mobile | first
  assign vertical_position_mobile = text_position_mobile | last

  assign text_position_modifier_mobile = 'center'

  if horizontal_position_mobile == 'flex-start'
    assign text_position_modifier_mobile = 'left'
  elsif horizontal_position_mobile == 'flex-end'
    assign text_position_modifier_mobile = 'right'
  endif

  assign placeholder_aspect_ratio = 'no-ratio'

  if section.settings.image_aspect == 'original'
    assign placeholder_aspect_ratio = 'square'
  endif
-%}

<header
  class="
    section
    section--full-width
    collection-banner
    collection-banner--image-aspect-{{ section.settings.image_aspect }}
    collection-banner--text-{{ text_position_modifier }}
    collection-banner--text-mobile-{{ text_position_modifier_mobile }}
    {%- if collection_image != blank -%}
      collection--has-image
      {{ section.settings.section_padding }}
    {%- endif -%}
    {%- if section.settings.show_breadcrumbs -%}
      collection--has-breadcrumbs
    {%- endif -%}
    {% if settings.enable_section_animations and section.settings.enable_animation %}
      animation
      animation--collection-banner
    {% endif %}
  "
  data-section-id="{{ section.id }}"
  data-section-type="collection-banner"
  data-handle="{{ collection.handle }}"
  style="
    --custom-height: {{ section.settings.desktop_height }}vh;
    --custom-height-mobile: {{ section.settings.mobile_height }}vh;
    --text-horizontal-position: {{ horizontal_position }};
    --text-vertical-position: {{ vertical_position }};
    --text-horizontal-position-mobile: {{ horizontal_position_mobile }};
    --text-vertical-position-mobile: {{ vertical_position_mobile }};
    {% if collection_image != blank -%}
      --color-text: {{ section.settings.text_color }};
      --color-text-link: {{ section.settings.text_color }};
    {% endif %}
    --overlay-background: {{ section.settings.color_overlay }};
    {% if section.settings.color_overlay_gradient != blank %}
      --overlay-background-gradient: {{ section.settings.color_overlay_gradient }};
    {% endif %}
    --overlay-opacity: {{ overlay_opacity }};
  "
>
  {% if section.settings.show_breadcrumbs and collection_image == blank %}
    <div class="collection-banner__breadcrumbs">
      {% render 'breadcrumbs', show_breadcrumbs: section.settings.show_breadcrumbs %}
    </div>
  {% endif %}
  <div class="collection-banner__inner">
    {%- if collection_image != blank -%}
      <div class="collection-banner__image-container">
        {%-
          render 'image' with
          wrapper_class: "collection-banner__image",
          image: collection_image,
          sizes: "100vw",
          focal_point: section.settings.focal_point,
          include_placeholder: false,
          placeholder_natural_fallback_ratio: placeholder_aspect_ratio,
          animate: true,
          prioritize_loading: true
        -%}
      </div>
      <div class="collection-banner__overlay"></div>
    {%- endif -%}

    <div class="collection-banner__text-container-wrapper">
      <div class="collection-banner__text-container">
        <div class="collection-banner__text-container-inner section-blocks animation--section-blocks">
          <h1 class="collection-banner__text-container-heading ff-heading fs-heading-2-base fs-heading-1-base-ns section-blocks__heading">
            {{ collection.title }}
          </h1>

          {%- if collection_description != blank -%}
            <div class="collection-banner__text-container-text rte ff-body section-blocks__text">
              {{ collection_description }}
            </div>
          {%- endif -%}
        </div>
      </div>
    </div>
    {% if section.settings.show_breadcrumbs and collection_image != blank %}
      <div class="collection-banner__breadcrumbs">
        {% render 'breadcrumbs', show_breadcrumbs: section.settings.show_breadcrumbs %}
      </div>
    {% endif %}
  </div>
</header>

{% schema %}
{
  "name": "t:sections.main_collection_banner.name",
  "class": "collection-section",
  "settings": [
    {
      "type": "checkbox",
      "id": "show_breadcrumbs",
      "label": "t:sections.main_collection_banner.settings.show_breadcrumbs.label"
    },
    {
      "type": "checkbox",
      "id": "show_collection_description",
      "label": "t:sections.main_collection_banner.settings.show_collection_description.label",
      "default": true
    },
    {
      "type": "header",
      "content": "t:sections.main_collection_banner.settings.collection_image_banner.header.content"
    },
    {
      "type": "checkbox",
      "id": "show_collection_image",
      "label": "t:sections.main_collection_banner.settings.collection_image_banner.show_collection_image.label"
    },
    {
      "type": "image_picker",
      "id": "image",
      "label": "t:sections.main_collection_banner.settings.collection_image_banner.image.label",
      "info": "t:sections.main_collection_banner.settings.collection_image_banner.image.info"
    },
    {
      "type": "radio",
      "id": "image_aspect",
      "label": "t:sections.main_collection_banner.settings.collection_image_banner.image_aspect.label",
      "options": [
        {
          "value": "original",
          "label": "t:shared.settings.image_height.image_aspect.options.original"
        },
        {
          "value": "custom",
          "label": "t:shared.settings.image_height.image_aspect.options.custom"
        }
      ],
      "default": "custom"
    },
    {
      "type": "range",
      "id": "desktop_height",
      "label": "t:shared.settings.image_height.desktop_height.label",
      "min": 50,
      "max": 100,
      "step": 5,
      "unit": "%",
      "default": 100
    },
    {
      "type": "range",
      "id": "mobile_height",
      "label": "t:shared.settings.image_height.mobile_height.label",
      "min": 50,
      "max": 100,
      "step": 5,
      "unit": "%",
      "default": 100
    },
    {
      "type": "paragraph",
      "content": "t:shared.settings.image_height.paragraph.content"
    },
    {
      "type": "select",
      "id": "focal_point",
      "label": "t:shared.settings.focal_point.image.default.label",
      "options": [
        {
          "value": "image_presentation",
          "label": "t:shared.options.focal_point.image_presentation"
        },
        {
          "value": "center",
          "label": "t:shared.options.focal_point.center"
        },
        {
          "value": "top",
          "label": "t:shared.options.focal_point.top"
        },
        {
          "value": "bottom",
          "label": "t:shared.options.focal_point.bottom"
        },
        {
          "value": "left",
          "label": "t:shared.options.focal_point.left"
        },
        {
          "value": "right",
          "label": "t:shared.options.focal_point.right"
        }
      ],
      "default": "image_presentation"
    },
    {
      "type": "select",
      "id": "text_position",
      "label": "t:sections.main_collection_banner.settings.collection_image_banner.text_position.label",
      "options": [
        {
          "value": "flex-start_flex-start",
          "label": "t:shared.options.alignment.full.top_left"
        },
        {
          "value": "center_flex-start",
          "label": "t:shared.options.alignment.full.top_center"
        },
        {
          "value": "flex-end_flex-start",
          "label": "t:shared.options.alignment.full.top_right"
        },
        {
          "value": "flex-start_center",
          "label": "t:shared.options.alignment.full.middle_left"
        },
        {
          "value": "center_center",
          "label": "t:shared.options.alignment.full.middle_center"
        },
        {
          "value": "flex-end_center",
          "label": "t:shared.options.alignment.full.middle_right"
        },
        {
          "value": "flex-start_flex-end",
          "label": "t:shared.options.alignment.full.bottom_left"
        },
        {
          "value": "center_flex-end",
          "label": "t:shared.options.alignment.full.bottom_center"
        },
        {
          "value": "flex-end_flex-end",
          "label": "t:shared.options.alignment.full.bottom_right"
        }
      ],
      "default": "center_center"
    },
    {
      "type": "select",
      "id": "text_position_mobile",
      "label": "t:sections.main_collection_banner.settings.collection_image_banner.text_position_mobile.label",
      "options": [
        {
          "value": "flex-start_flex-start",
          "label": "t:shared.options.alignment.full.top_left"
        },
        {
          "value": "center_flex-start",
          "label": "t:shared.options.alignment.full.top_center"
        },
        {
          "value": "flex-end_flex-start",
          "label": "t:shared.options.alignment.full.top_right"
        },
        {
          "value": "flex-start_center",
          "label": "t:shared.options.alignment.full.middle_left"
        },
        {
          "value": "center_center",
          "label": "t:shared.options.alignment.full.middle_center"
        },
        {
          "value": "flex-end_center",
          "label": "t:shared.options.alignment.full.middle_right"
        },
        {
          "value": "flex-start_flex-end",
          "label": "t:shared.options.alignment.full.bottom_left"
        },
        {
          "value": "center_flex-end",
          "label": "t:shared.options.alignment.full.bottom_center"
        },
        {
          "value": "flex-end_flex-end",
          "label": "t:shared.options.alignment.full.bottom_right"
        }
      ],
      "default": "center_center"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "t:shared.settings.color.general.text.label",
      "default": "#FFFFFF"
    },
    {
      "type": "color",
      "id": "color_overlay",
      "label": "t:shared.settings.overlay.overlay.label",
      "default": "#000000"
    },
    {
      "type": "color_background",
      "id": "color_overlay_gradient",
      "label": "t:shared.settings.overlay.overlay_gradient.label"
    },
    {
      "type": "range",
      "id": "overlay_opacity",
      "label": "t:shared.settings.overlay.overlay_opacity.label",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "%",
      "default": 30
    },
    {
      "type": "header",
      "content": "t:shared.settings.section_style.header.content"
    },
    {
      "type": "checkbox",
      "id": "enable_animation",
      "label": "t:shared.settings.section_style.enable_animation.label",
      "default": true,
      "info": "t:shared.settings.section_style.enable_animation.info"
    },
    {
      "type": "select",
      "id": "section_padding",
      "label": "t:shared.settings.section_style.section_padding.label",
      "options": [
        {
          "value": "section--vertical-padding-none",
          "label": "t:shared.settings.section_style.section_padding.options.none"
        },
        {
          "value": "section--vertical-padding-top-bottom",
          "label": "t:shared.settings.section_style.section_padding.options.both"
        },
        {
          "value": "section--vertical-padding-top-only",
          "label": "t:shared.settings.section_style.section_padding.options.top"
        },
        {
          "value": "section--vertical-padding-bottom-only",
          "label": "t:shared.settings.section_style.section_padding.options.bottom"
        }
      ],
      "default": "section--vertical-padding-none"
    }
  ]
}
{% endschema %}

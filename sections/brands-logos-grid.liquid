{%- comment -%}
Brands logos grid — ONLY brands that have a linked product on the brand metaobject.
- Metaobject type default: brand_info
- Product field default: Build_kit_product (Product reference)
- Optional fields: Brand_logo (image/file), Brand_name (text)
- No collection filtering at all (per request).
{%- endcomment -%}

{% assign meta_type     = section.settings.metaobject_type  | default: 'brand_info' %}
{% assign img_key_in    = section.settings.image_field      | default: 'Brand_logo' %}
{% assign name_key_in   = section.settings.name_field       | default: 'Brand_name' %}
{% assign product_field = section.settings.product_field    | default: 'Build_kit_product' %}
{% assign cols          = section.settings.columns_desktop  | default: 5 %}

{% assign brand_entries = shop.metaobjects[meta_type].values %}

<section class="multi-column" id="brands-logos-{{ section.id }}">
  <div class="page-width">

    <style>
      #brands-logos-{{ section.id }} .multi-column__grid{
        --columns-desktop: {{ cols }};
        display:grid;
        grid-template-columns: repeat(var(--columns-desktop), 1fr);
        gap: clamp(18px, 3vw, 28px);
      }
      @media (max-width:1024px){
        #brands-logos-{{ section.id }} .multi-column__grid{ grid-template-columns: repeat(3,1fr); }
      }
      @media (max-width:640px){
        #brands-logos-{{ section.id }} .multi-column__grid{ grid-template-columns: repeat(2,1fr); }
      }

      #brands-logos-{{ section.id }} .brand-card .multi-column__grid-item-inner{
        display:flex; flex-direction:column; align-items:center; gap:12px;
      }
      #brands-logos-{{ section.id }} .brand-card .multi-column__grid-item-image-wrapper{
        position:relative; width:100%; padding-top:100%;
        background:#fff !important; border:1px solid #e6e6e6 !important; border-radius:12px !important;
        overflow:hidden; box-sizing:border-box; display:block;
        transition:border-color .2s ease, box-shadow .2s ease, transform .2s ease;
      }
      #brands-logos-{{ section.id }} .brand-card .multi-column__grid-item-image-wrapper:hover{
        border-color:#dcdcdc !important; box-shadow:0 2px 10px rgba(0,0,0,.04); transform:translateY(-1px);
      }
      #brands-logos-{{ section.id }} .brand-card .multi-column__grid-item-image{
        position:absolute; inset:10%;
        width:80%; height:80%;
        object-fit:contain !important; object-position:center; display:block;
      }
      @media (min-width:1024px){
        #brands-logos-{{ section.id }} .brand-card .multi-column__grid-item-image{ inset:8%; width:84%; height:84%; }
      }
      #brands-logos-{{ section.id }} .brand-card .multi-column__grid-item-image-wrapper.is-empty{
        border-style:dashed !important; border-color:#e0e0e0 !important; background:#fafafa !important;
      }
      #brands-logos-{{ section.id }} .brand-card .brand-logo--placeholder{
        position:absolute; inset:0; display:flex; align-items:center; justify-content:center; color:#c9c9c9;
      }
      #brands-logos-{{ section.id }} .brand-card .multi-column__grid-item-text-container{
        width:100%; text-align:center;
      }
      #brands-logos-{{ section.id }} .brand-card .multi-column__grid-item-heading{
        margin:0; line-height:1.25;
      }
      #brands-logos-{{ section.id }} .brand-card .multi-column__grid-item-heading a{
        text-decoration:none;
      }
    </style>

    <div class="multi-column__grid">
      {%- for entry in brand_entries -%}
        {%- comment -%} חובה: מוצר מקושר בשדה product_field {%- endcomment -%}
        {%- assign product_ref = entry[product_field] -%}
        {%- if product_ref == blank and entry.fields[product_field] -%}
          {%- assign product_ref = entry.fields[product_field].value -%}
        {%- endif -%}

        {%- assign product_obj = blank -%}
        {%- if product_ref and product_ref.value -%}
          {%- assign product_obj = product_ref.value -%}
        {%- elsif product_ref -%}
          {%- assign product_obj = product_ref -%}
        {%- endif -%}

        {%- if product_obj and product_obj.url != blank -%}
          {%- assign display_name = entry[name_key_in] | default: entry.fields[name_key_in].value | default: entry.handle -%}
          {%- assign image_obj    = entry[img_key_in]  | default: entry.fields[img_key_in].value -%}
          {%- assign target_url   = product_obj.url -%}

          {%- assign logo_src = nil -%}
          {%- if image_obj -%}
            {%- if image_obj.mime_type and image_obj.mime_type contains 'svg' -%}
              {%- assign logo_src = image_obj | file_url -%}
            {%- else -%}
              {%- assign logo_src = image_obj | image_url: width: 900 -%}
            {%- endif -%}
          {%- endif -%}

          <div class="multi-column__grid-item brand-card">
            <div class="multi-column__grid-item-inner">
              <figure class="multi-column__grid-item-image-figure" data-image-crop-circle="false">
                <a href="{{ target_url }}"
                   class="multi-column__grid-item-image-wrapper{% if logo_src == nil %} is-empty{% endif %}"
                   aria-label="{{ display_name }}">
                  {% if logo_src %}
                    <img class="multi-column__grid-item-image" src="{{ logo_src }}" alt="{{ display_name }}" loading="lazy">
                  {% else %}
                    <div class="brand-logo--placeholder" aria-hidden="true">
                      <svg viewBox="0 0 48 48" width="40" height="40">
                        <rect x="6" y="10" width="36" height="28" rx="3" ry="3" fill="none" stroke="currentColor" stroke-width="1.5"/>
                        <circle cx="18" cy="20" r="3" fill="currentColor" opacity=".25"/>
                        <path d="M10 34l11-12 8 8 5-5 8 9" fill="none" stroke="currentColor" stroke-width="1.5" opacity=".35"/>
                      </svg>
                    </div>
                  {% endif %}
                </a>
              </figure>

              <div class="multi-column__grid-item-text-container">
                <h3 class="multi-column__grid-item-heading ff-heading fs-heading-4-base">
                  <a href="{{ target_url }}" aria-label="{{ display_name }}">{{ display_name }}</a>
                </h3>
              </div>
            </div>
          </div>
        {%- endif -%}
      {%- endfor -%}
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Brands logos grid ",
  "settings": [
    { "type": "text", "id": "metaobject_type", "label": "Metaobject type", "default": "brand_info" },
    { "type": "text", "id": "image_field", "label": "Image field (image/file)", "default": "Brand_logo" },
    { "type": "text", "id": "name_field",  "label": "Name field (text)",  "default": "Brand_name" },
    { "type": "text", "id": "product_field", "label": "Product field (product reference)", "default": "Build_kit_product" },
    { "type": "number", "id": "columns_desktop", "label": "Columns (desktop)", "default": 5 }
  ],
  "presets": [{ "name": "Brands logos grid" }]
}
{% endschema %}
